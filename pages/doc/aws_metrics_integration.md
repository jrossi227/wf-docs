---
title: AWS Metrics Integration
keywords:
tags: [integrations]
sidebar: doc_sidebar
permalink: aws_metrics_integration.html
summary: This topic describes how to send AWS data to Wavefront.
---

<a href="http://aws.amazon.com/">Amazon Web Services</a> (AWS), is a cloud-computing platform offered by Amazon. Wavefront supports cloud integrations, which allow you to ingest metrics directly from AWS and send them to Wavefront without needing to set up a Wavefront Proxy. The AWS cloud integration is the quickest and easiest way to get your <a href="http://aws.amazon.com/cloudwatch">CloudWatch</a> and/or <a href="http://aws.amazon.com/cloudtrail">CloudTrail</a> data into Wavefront. Your Wavefront account must have Agent Management permission to set up AWS cloud integration:

Wavefront supports three types of cloud integrations:

-   **CloudWatch** - Retrieves AWS metric and dimension data using the AWS CloudWatch API.
-   **CloudTrail** - Retrieves EC2 event information stored in JSON-formatted log files in an AWS S3 bucket.
-   **EC2** - Retrieves metrics from AWS APIs other than CloudWatch.

The mechanism to establish trust between Wavefront and AWS requires sharing an **external ID** between the two services. The external ID can be generated by Wavefront or by your company. The source of the external ID affects how you set up the integration. If you use an external ID generated by Wavefront you can set up all integration types at once. If you want to use an external ID generated by your company you must set up each integration separately.

In summary, the integration options are:

-   **Set up Amazon Account** - Integrate CloudWatch, Cloudtrail, and EC2 data. Choose this option if:
    -   You are an administrator for your company's AWS account.
    -   You want to integrate CloudWatch, CloudTrail, and EC2 data into Wavefront at the same time.
    -   You can use an external ID generated by Wavefront.
    -   You want Wavefront to automatically install AWS dashboards.
-   **Register [CloudWatch \| CloudTrail \| EC2]** - Integrate each type of data individually. Choose this option if:
    -   You are not an administrator for your company's AWS account, but will be gathering required information from an administrator.
    -   You want to integrate CloudWatch, CloudTrail, and EC2 data into Wavefront, but not at the same time.
    -   You want to use a custom external ID generated by your company.
    -   You can manually install AWS dashboards.Â  For a list of dashboards and more information, contact <a href="mailto:support@wavefront.com" class="jive-link-email-small">support@wavefront.com</a>.

## Granting Wavefront Read-only Access to your Amazon Account

Regardless of the integration type you choose, first grant Wavefront read-only access to your Amazon account as described in the **Add Integration &gt; Set up Amazon Account** wizard. The Wavefront wizard instructs you to run the Amazon **Create New Role** wizard where you provide a Wavefront account and external ID. In the **External ID field**, enter the **wave&lt;3-digit number&gt;** generated in the Set up Amazon Account wizard or a custom external ID created by your company. The external ID generated by the Set up Amazon Account wizard changes *each time* you run the wizard. In the Amazon Create New Role wizard Review screen, copy the Role ARN:

[<img src="images/role_arn.png" alt="images/role_arn.png"/>](/images/role_arn.png)


## Adding a Cloud Integration


1.  Select **Browse &gt;** **Cloud Integrations**.
2.  Select **Add Integration &gt; &lt;Integration Option&gt;**, where  **&lt;Integration Option&gt;** is **Set up Amazon Account** or **Register [CloudWatch \| CloudTrail \| EC2]**.
3.  Configure the integration:
    -   **Common**
        -   **Name** - Name to identify the integration.
        -   **Role ARN** - Role ARN from Amazon account. The format of this property is **arn:aws:iam::&lt;Amazon account ID&gt;:role/wavefront**.
    -   **Set Up Amazon Account and Register Cloudtrail**
        -   **Bucket Name -** The S3 bucket containing CloudTrail logs. In AWS, go to **CloudTrail** &gt;**Trails** to see the bucket name.
        -   **Prefix** - A log file prefix specified when you created the CloudTrail.
    -   **Register [CloudWatch \| CloudTrail \| EC2]**
        -   **External ID -** External ID generated by your company used to establish trust between Amazon and Wavefront.
    -   **Register CloudWatch**
        -   Whitelists - see <a href="#whitelist">Configuring AWS CloudWatch Metric Ingestion</a>.
4.  Click **Save**. The selected integration(s) are created and added to the Cloud Integrations list.
5.  Optional. If you selected **Set up Amazon Account** and want to whitelist AWS instances, volumes, or metrics, click the link in the Name column in the CloudWatch integration type row.
6.  Configure CloudWatch whitelist properties.
7.  Click **Save.**

## CloudWatch Integration

The Wavefront CloudWatch integration retrieves AWS metric and dimension data from AWS services using the AWS CloudWatch API. The complete list of metrics and dimensions that can be retrieved from AWS CloudWatch is available at <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CW_Support_For_AWS.html">Amazon CloudWatch Metrics and Dimensions Reference</a>. In addition, you can publish <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/publishingMetrics.html">custom AWS metrics</a> that are also ingested by the Wavefront CloudWatch integration.

<span id="whitelist">

### Configuring CloudWatch Metric Ingestion

To configure which AWS metrics to ingest into Wavefront you can whitelist instances, volumes, and metrics:

-   **Volume Whitelist** fields - Whitelist instances and volumes by specifying <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">EC2 tags</a> (as **&lt;key&gt;=&lt;value&gt;** pairs) defined on the instances and volumes. For example, **organization=&lt;yourcompany&gt;**. When specified as a comma-separated list, the tags are OR'd. To use instance and volume whitelisting you must also add an EC2 integration as the AWS tags are imported from EC2. If you don't specify any tags, Wavefront imports metrics from *all* instances and volumes.
-   **RegExp Whitelist** field - Whitelist metrics by specifying a regular expression. The regular expression must be a complete match of the entire metric name. For example, if you only want CloudWatch data for **elb** and **rds** (which come under **aws\.rds**), then use a regular expression such as: **^aws\.\(elb\|rds\)\.\*\$**. If you do not specify a regular expression, *all* CloudWatch metrics are retrieved.

### Wavefront Source Field

Wavefront sets the value of the CloudWatch metric <a href="https://community.wavefront.com/docs/DOC-1031""><strong>source</strong> field</a> by service according to the following algorithm:

-   **EC2** - the value of the **hostname**, **host**, or **name** <a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">EC2 tags</a>, if the tags exist and you have an EC2 integration. Otherwise, the source is set to the Amazon instance ID.
-   **ELB** - the Amazon instance ID of the EC2 instance the load balancer is attached to.
-   All other services - the value of the *first* CloudWatch dimension. The supported dimensions appear at the bottom of the Amazon service metric documentation topic. For example, see <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/ec2-metricscollected.html#ec2-metric-dimensions">Amazon EC2 Dimensions</a>.

### Wavefront Point Tags

Wavefront adds the following point tags to CloudWatch metrics:

-   **accountId** - the Amazon account that reported the metric.
-   **Region** - The region in which the service is running. Added to EC2 and EBS metrics only.
-   CloudWatch dimensions. The dimensions vary by service. For example, for AWS S3, the BucketName dimension is added as a point tag.



### CloudWatch Pricing

Standard AWS CloudWatch pricing applies each time Wavefront requests metrics using the CloudWatch API. For pricing information, see <a href="http://aws.amazon.com/cloudwatch/pricing">AWS | Amazon CloudWatch | Pricing</a>. After selecting a region in the middle of the page, you can find the current expected price under **Amazon CloudWatch API Requests**. In addition, custom metrics have a premium price; see the **Amazon CloudWatch Custom Metrics** section of the pricing page. To limit cost, Wavefront queries the API only every 5 minutes.

As an alternative to using the CloudWatch API for EC2 metrics, you can collect these metrics using <a href="https://community.wavefront.com/docs/DOC-1246#jive_content_id_The_Install_Command"">a Telegraf collector</a> on each AWS instance. In this case, to prevent CloudWatch from requesting those metrics, you should use the metrics RegExp whitelist to allow all metrics except EC2. For example: **^aws\.\(billing\|instance\|sqs\|sns\|reservedInstance\|ebs\|route53\.health\|ec2.status\|elb\|s3\)\.\*\$**.

### Configuring Billing Metrics

The AWS Billing and Cost Management service sends <a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/billing-metricscollected.html">billing metrics</a> to CloudWatch. You configure AWS to produce **aws.billing.\*** metrics by checking the **Receive Billing Alerts** checkbox on the **Preferences** tab in the <a href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/monitor-charges.html">AWS Billing and Cost Management console</a>:

[<img src="images/aws_billing.png" alt="images/aws_billing.png"/>](images/aws_billing.png)

In addition to CloudWatch dimensions, Wavefront adds a **Source** point tag to billing metrics.

## CloudTrail Integration

The Wavefront CloudTrail integration retrieves EC2 event information stored in JSON-formatted log files in an S3 bucket. The CloudTrail integration parses the files for all events that result from an operation that is not a describe, get, or list, and creates a Wavefront System event.

You can search for these events in the **Browse &gt; Events** page. Such events are prefaced with **AWS Action:** and include actions such as RunInstances, StartInstances, StopInstances, TerminateInstances, MonitorInstances, UnmonitorInstances, DeleteNetworkInterface, AuthorizeSecurityGroupIngress, CreateSecurityGroup, RequestSpotInstances, CancelSpotInstanceRequests, ModifyInstanceAttribute, CreateTags,CreateKeyPair, DeleteKeyPair, and DeregisterImage. For example:

[<img src="images/aws_runinstances.png" alt="aws_runinstances.png"/>](images/aws_runinstances.png)

Click the **View System Event** link to view details about the event.

## EC2 Integration

The Wavefront EC2 integration retrieves additional metrics using AWS API calls other than CloudWatch:

-   **aws.instance.price** - Instances and how much they cost per hour. This metric includes the point tags **instanceID**, **instanceType**, **availabilityZone**, and **instanceLifecycle**.
-   **aws.reservedinstance.count** - The number of reserved instances in each availability zone by each instance type. This metric includes the point tags **instanceID**, **availabilityZone**, and **instanceType**. This metric appears only if your account has reserved instances.
-   **aws.ebs.volumesize** - The volume size of the elastic block store attached to EC2 instance(s). This metric also includes the point tags **Region**, **volumeID**, **instanceID**, and **Status**. This metric appears in Wavefront only if your account uses EBS.
-   **aws.ebs.volumeiops** - The volume I/O operations of the elastic block store attached to EC2 instance(s). This metric also includes the point tags **Region**, **volumeID**, **instanceID**, and **Status**. This metric appears in Wavefront only if your account uses EBS.

The **source** property of these metrics is set to the AWS instance ID.

## Viewing AWS Metrics

You can view AWS metrics by selecting **Browse &gt; Metrics** and searching for metrics beginning with **aws.**:

[<img src="images/aws_metrics.png" alt="aws_metrics.png"/>](images/aws_metrics.png)

You can drill into the folder for a specific service and click a metric to navigate to a chart that displays that set of data. For example, clicking the metric **aws.ec2.cpuutilization** and then refining the query by the **Region** point tag and the **topk** function yields the following chart:  

[<img src="images/aws.cpuutilization.png" alt="aws.cpuutilization.png"/>](images/aws.cpuutilization.png)


### AWS Aggregate Metrics


All AWS metrics return the following aggregate metrics: average, maximum, minimum, sample count, and sum. To view the aggregate metrics,

1.  Search for a specific metric, for example **aws.ec2.cpuutilization**:

    [<img src="images/aws.cpuutilization_metric.png" alt="aws.cpuutilization_metric.png"/>](images/aws.cpuutilization_metric.png)

2.  Click the metric folder, for example **aws.ec2.cpuutilization.,** to display the aggregate metrics:

    [<img src="images/aws.cpuutilization_aggregate_metrics.png" alt="aws.cpuutilization_aggregate_metrics.png"/>](images/aws.cpuutilization_aggregate_metrics.png)

{% include links.html %}
